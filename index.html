<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>442 é€²æ”»å‹å†å¹³è¡¡åŠ©æ‰‹</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        input[type="number"] { font-size: 16px !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans selection:bg-indigo-500 selection:text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // é è¨­é¡è‰²åº«
        const COLORS = [
            { icon: 'ğŸ’', color: 'text-blue-400', border: 'focus-within:border-blue-500', bg: 'bg-blue-500' },
            { icon: 'âš¡', color: 'text-amber-400', border: 'focus-within:border-amber-500', bg: 'bg-amber-500' },
            { icon: 'ğŸ›¡ï¸', color: 'text-emerald-400', border: 'focus-within:border-emerald-500', bg: 'bg-emerald-500' },
            { icon: 'ğŸš€', color: 'text-purple-400', border: 'focus-within:border-purple-500', bg: 'bg-purple-500' },
            { icon: 'ğŸŒŸ', color: 'text-pink-400', border: 'focus-within:border-pink-500', bg: 'bg-pink-500' },
            { icon: 'ğŸŒŠ', color: 'text-cyan-400', border: 'focus-within:border-cyan-500', bg: 'bg-cyan-500' },
        ];

        const App = () => {
            // åˆå§‹åŒ–è³‡ç”¢åˆ—è¡¨ (é è¨­ç‚º 442 é€²æ”»å‹é…ç½®)
            const [assets, setAssets] = useState([
                { 
                    id: 1, type: 'single', label: '00662 (æ ¸å¿ƒ)', value: '', target: 40, theme: COLORS[0], locked: true 
                },
                { 
                    id: 2, type: 'single', label: '00631L (æ§“æ¡¿)', value: '', target: 40, theme: COLORS[1], locked: false 
                },
                { 
                    id: 3, type: 'group', label: 'é˜²ç¦¦éƒ¨ä½ (å…±ç”¨ä½”æ¯”)', target: 20, theme: COLORS[2], locked: false,
                    subAssets: [
                        { id: 's1', label: 'ç¾é‡‘/æ´»å­˜', value: '' },
                        { id: 's2', label: 'é¡ç¾é‡‘ (00865B)', value: '' }
                    ]
                }
            ]);

            // æ–°å¢ä¸€èˆ¬æ¨™çš„
            const addAsset = () => {
                const newId = Date.now();
                const themeIndex = (assets.length) % COLORS.length;
                setAssets([...assets, {
                    id: newId,
                    type: 'single',
                    label: 'æ–°æŠ•è³‡æ¨™çš„',
                    value: '',
                    target: 0,
                    theme: COLORS[themeIndex],
                    locked: false
                }]);
            };

            // åˆªé™¤æ¨™çš„
            const removeAsset = (id) => {
                if (assets.length <= 1) return;
                setAssets(assets.filter(a => a.id !== id));
            };

            // åˆ‡æ›é–å®šç‹€æ…‹
            const toggleLock = (id) => {
                setAssets(assets.map(a => a.id === id ? { ...a, locked: !a.locked } : a));
            };

            // æ›´æ–°ä¸€èˆ¬æ¨™çš„æˆ–ç¾¤çµ„ç›®æ¨™
            const updateAsset = (id, field, val) => {
                setAssets(assets.map(a => a.id === id ? { ...a, [field]: val } : a));
            };

            // æ›´æ–°ç¾¤çµ„å…§çš„å­æ¨™çš„
            const updateSubAsset = (parentId, subId, field, val) => {
                setAssets(assets.map(a => {
                    if (a.id !== parentId) return a;
                    return {
                        ...a,
                        subAssets: a.subAssets.map(s => s.id === subId ? { ...s, [field]: val } : s)
                    };
                }));
            };

            // è¨ˆç®—æ ¸å¿ƒé‚è¼¯
            const report = useMemo(() => {
                // 1. è¨ˆç®—ç¸½è³‡ç”¢
                let totalWealth = 0;
                assets.forEach(a => {
                    if (a.type === 'single') {
                        totalWealth += (parseFloat(a.value) || 0);
                    } else {
                        a.subAssets.forEach(s => {
                            totalWealth += (parseFloat(s.value) || 0);
                        });
                    }
                });

                // 2. è¨ˆç®—ç¸½ç›®æ¨™æ¯”ä¾‹
                const totalTargetRatio = assets.reduce((sum, a) => sum + (parseFloat(a.target) || 0), 0);
                const isRatioValid = Math.abs(totalTargetRatio - 100) < 0.1;

                if (totalWealth <= 0) return { isValid: isRatioValid, totalTargetRatio, totalWealth, data: [], actions: [] };

                // 3. è¨ˆç®—æ¯å€‹é …ç›®çš„æ•¸æ“š
                const data = assets.map(asset => {
                    let currentVal = 0;
                    if (asset.type === 'single') {
                        currentVal = parseFloat(asset.value) || 0;
                    } else {
                        currentVal = asset.subAssets.reduce((sum, s) => sum + (parseFloat(s.value) || 0), 0);
                    }

                    const targetRatio = (parseFloat(asset.target) || 0) / 100;
                    const targetAmount = totalWealth * targetRatio;
                    let diff = targetAmount - currentVal;
                    let isLockedPreventSell = false;

                    // *** é–å®šé‚è¼¯ ***
                    // å¦‚æœå·²é–å®š(locked=true) ä¸” æ‡‰èª¿æ•´é‡‘é¡ç‚ºè² (diff < 0, å³å»ºè­°è³£å‡º)
                    // å‰‡å¼·åˆ¶ä¸è³£å‡º (diff = 0)
                    if (asset.locked && diff < 0) {
                        diff = 0;
                        isLockedPreventSell = true;
                    }
                    
                    return {
                        ...asset,
                        currentVal,
                        currentRatio: currentVal / totalWealth,
                        targetRatio,
                        targetAmount,
                        diff,
                        isLockedPreventSell
                    };
                });

                // 4. ç”¢ç”Ÿå»ºè­°è·¯å¾‘ (å…ˆè³£å¾Œè²·)
                let actions = [];
                const sellActions = [];
                const buyActions = [];

                data.forEach(info => {
                    const subject = info.type === 'group' ? `${info.label} (ç¸½å’Œ)` : info.label;
                    
                    if (info.isLockedPreventSell) {
                        // é–å®šä¸è³£å‡ºï¼Œä¸ç”¢ç”Ÿå‹•ä½œï¼Œä½†å¯ä»¥åœ¨ä»‹é¢ä¸Šé¡¯ç¤ºç‹€æ…‹
                    } else if (info.diff < -1) {
                        const amount = Math.abs(Math.round(info.diff)).toLocaleString();
                        sellActions.push(`è³£å‡º/æé ˜ ${subject}ï¼š$${amount}`);
                    } else if (info.diff > 1) {
                        const amount = Math.round(info.diff).toLocaleString();
                        buyActions.push(`è²·å…¥/å­˜å…¥ ${subject}ï¼š$${amount}`);
                    }
                });

                actions = [...sellActions, ...buyActions];

                return { 
                    isValid: isRatioValid, 
                    totalTargetRatio, 
                    totalWealth, 
                    data, 
                    actions 
                };
            }, [assets]);

            return (
                <div className="min-h-screen pb-20">
                    {/* Header */}
                    <header className="bg-slate-800/80 backdrop-blur-md border-b border-slate-700 sticky top-0 z-20 px-4 py-4 flex items-center justify-between shadow-lg">
                        <div className="flex items-center gap-3">
                            <div className="bg-gradient-to-br from-amber-500 to-orange-600 text-white w-10 h-10 rounded-xl flex flex-col items-center justify-center font-black text-[10px] shadow-lg border border-white/10 leading-none">
                                442
                            </div>
                            <div>
                                <h1 className="text-lg font-bold text-white tracking-tight">é€²æ”»å‹å†å¹³è¡¡</h1>
                                <p className="text-[10px] text-slate-400 font-bold uppercase tracking-wider">40/40/20 Strategy</p>
                            </div>
                        </div>
                        {report.totalWealth > 0 && (
                            <div className="text-right animate-fade-in">
                                <p className="text-[10px] font-bold text-slate-400 uppercase leading-none mb-1">Total Assets</p>
                                <p className="text-lg font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-400">${Math.round(report.totalWealth).toLocaleString()}</p>
                            </div>
                        )}
                    </header>

                    <main className="px-4 py-6 space-y-8 max-w-md mx-auto">
                        
                        {/* è³‡ç”¢è¨­å®šå€ */}
                        <section className="space-y-4">
                            <div className="flex justify-between items-end px-1">
                                <h2 className="text-xs font-black text-slate-500 uppercase tracking-widest">æŠ•è³‡çµ„åˆé…ç½®</h2>
                                <span className={`text-[10px] px-2 py-1 rounded-full border transition-all duration-300 ${report.isValid ? 'text-emerald-400 border-emerald-500/30 bg-emerald-500/10' : 'text-rose-400 border-rose-500/50 bg-rose-500/10 animate-pulse'}`}>
                                    ç¸½æ¯”ä¾‹: {report.totalTargetRatio}% {report.isValid ? 'âœ…' : '(éœ€ç‚º 100%)'}
                                </span>
                            </div>
                            
                            <div className="space-y-4">
                                {assets.map((item) => (
                                    <div key={item.id} className={`bg-slate-800 rounded-2xl border shadow-sm relative group overflow-hidden transition-all ${item.locked ? 'border-amber-500/50 shadow-amber-900/20' : 'border-slate-700'} ${item.type === 'group' && !item.locked ? 'border-l-4 border-l-emerald-500' : ''}`}>
                                        
                                        {/* æ¨™é¡Œèˆ‡å·¥å…·åˆ— */}
                                        <div className="p-3 flex items-center gap-3 bg-slate-800/50 border-b border-slate-700/50 relative">
                                            
                                            {/* é–å®šæŒ‰éˆ• */}
                                            <button 
                                                onClick={() => toggleLock(item.id)}
                                                className={`w-8 h-8 rounded-lg flex items-center justify-center transition-all ${item.locked ? 'bg-amber-500 text-white shadow-lg shadow-amber-500/20' : 'bg-slate-700 text-slate-400 hover:bg-slate-600'}`}
                                                title={item.locked ? "å·²é–å®š (ä¸è³£å‡º)" : "é»æ“Šé–å®š"}
                                            >
                                                {item.locked ? 'ğŸ”’' : 'ğŸ”“'}
                                            </button>

                                            <div className="flex-1">
                                                <div className="flex items-center gap-1">
                                                    <span className="text-sm">{item.theme.icon}</span>
                                                    <input 
                                                        type="text" 
                                                        value={item.label}
                                                        onChange={(e) => updateAsset(item.id, 'label', e.target.value)}
                                                        className={`w-full bg-transparent text-[11px] font-bold ${item.theme.color} uppercase tracking-wide outline-none border-b border-transparent focus:border-slate-500 placeholder:text-slate-600`}
                                                    />
                                                </div>
                                                {item.type === 'group' && <p className="text-[9px] text-slate-500 ml-1 mt-0.5">ç¾¤çµ„å…±ç”¨ä½”æ¯”</p>}
                                                {item.locked && <span className="text-[9px] text-amber-500 font-bold ml-1">â— åªè²·ä¸è³£</span>}
                                            </div>
                                            
                                            {/* ç›®æ¨™ % è¼¸å…¥ */}
                                            <div className="w-14 relative">
                                                <input 
                                                    type="number" 
                                                    value={item.target} 
                                                    onChange={(e) => updateAsset(item.id, 'target', e.target.value)}
                                                    className="w-full bg-slate-900/80 rounded-lg px-2 py-1 text-center font-bold text-sm text-white border border-slate-600 focus:border-indigo-400 outline-none"
                                                    placeholder="0"
                                                />
                                                <span className="absolute right-1 top-1.5 text-[10px] text-slate-500 pointer-events-none">%</span>
                                            </div>

                                            {/* åˆªé™¤æŒ‰éˆ• (æœªé–å®šä¸”éå”¯ä¸€æ™‚å¯åˆª) */}
                                            {item.type !== 'group' && (
                                                <button 
                                                    onClick={() => removeAsset(item.id)}
                                                    className="w-6 h-6 text-slate-600 hover:text-rose-400 transition-colors"
                                                >âœ•</button>
                                            )}
                                        </div>

                                        {/* å¸‚å€¼è¼¸å…¥å€åŸŸ */}
                                        <div className="p-3 space-y-2">
                                            {item.type === 'single' ? (
                                                <div className="flex items-center justify-between">
                                                    <label className="text-[10px] text-slate-500 font-bold">ç›®å‰å¸‚å€¼</label>
                                                    <div className="flex-1 ml-4 relative">
                                                        <span className="absolute left-0 top-1 text-slate-600 text-lg">$</span>
                                                        <input 
                                                            type="number" 
                                                            value={item.value} 
                                                            onChange={(e) => updateAsset(item.id, 'value', e.target.value)} 
                                                            placeholder="0" 
                                                            className="w-full bg-transparent border-none outline-none font-black text-2xl text-right text-white placeholder:text-slate-700"
                                                        />
                                                    </div>
                                                </div>
                                            ) : (
                                                item.subAssets.map(sub => (
                                                    <div key={sub.id} className="flex items-center justify-between bg-slate-900/30 p-2 rounded-xl border border-slate-700/30">
                                                        <input 
                                                            type="text" 
                                                            value={sub.label}
                                                            onChange={(e) => updateSubAsset(item.id, sub.id, 'label', e.target.value)}
                                                            className="bg-transparent text-[10px] font-bold text-slate-400 w-24 outline-none border-b border-transparent focus:border-slate-600 focus:text-slate-300"
                                                        />
                                                        <div className="flex-1 ml-2 relative">
                                                            <span className="absolute left-0 top-0.5 text-slate-600 text-sm">$</span>
                                                            <input 
                                                                type="number" 
                                                                value={sub.value} 
                                                                onChange={(e) => updateSubAsset(item.id, sub.id, 'value', e.target.value)}
                                                                placeholder="0" 
                                                                className="w-full bg-transparent border-none outline-none font-bold text-lg text-right text-white placeholder:text-slate-700"
                                                            />
                                                        </div>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                        
                                        {item.type === 'group' && (
                                            <div className="px-3 pb-2 flex justify-end">
                                                <p className="text-[9px] text-emerald-500 font-mono">
                                                    ç¾¤çµ„ç¸½è¨ˆ: ${Math.round(item.subAssets.reduce((sum, s) => sum + (parseFloat(s.value) || 0), 0)).toLocaleString()}
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                ))}

                                {/* æ–°å¢æŒ‰éˆ• */}
                                <button 
                                    onClick={addAsset}
                                    className="w-full py-3 rounded-2xl border-2 border-dashed border-slate-700 text-slate-500 font-bold text-sm hover:border-indigo-500 hover:text-indigo-400 hover:bg-slate-800/50 transition-all flex items-center justify-center gap-2"
                                >
                                    <span>ï¼‹</span> æ–°å¢å–®ä¸€æ¨™çš„
                                </button>
                            </div>
                        </section>

                        {report.totalWealth > 0 && report.isValid ? (
                            <div className="space-y-8 animate-fade-in">
                                {/* Dashboard */}
                                <section>
                                    <h2 className="text-xs font-black text-slate-500 uppercase tracking-widest px-1 mb-3">é…ç½®ç›£æ§å„€è¡¨æ¿</h2>
                                    <div className="grid grid-cols-1 gap-3">
                                        {report.data.map((data) => {
                                            const diffPercent = (data.currentRatio - data.targetRatio) * 100;
                                            const isBalanced = Math.abs(diffPercent) < 1;
                                            const isHigher = diffPercent >= 0;
                                            
                                            // Status UI
                                            let statusColor, statusText;
                                            
                                            if (data.isLockedPreventSell) {
                                                statusColor = 'bg-amber-500/10 border-amber-500/30 text-amber-400';
                                                statusText = 'ğŸ”’ é–å®šä¸­ (è¶…æ¨™ä¸è³£)';
                                            } else {
                                                statusColor = isBalanced ? 'bg-emerald-500/10 border-emerald-500/30 text-emerald-400' : (isHigher ? 'bg-emerald-500/10 border-emerald-500/30 text-emerald-400' : 'bg-rose-500/10 border-rose-500/30 text-rose-400');
                                                statusText = isBalanced ? 'â— å®Œç¾å¹³è¡¡' : (isHigher ? `â–² é«˜å‡º ${Math.abs(diffPercent).toFixed(1)}%` : `â–¼ ä½æ–¼ ${Math.abs(diffPercent).toFixed(1)}%`);
                                            }

                                            return (
                                                <div key={data.id} className={`bg-slate-800 p-4 rounded-2xl border shadow-sm relative overflow-hidden ${data.locked ? 'border-amber-500/30' : 'border-slate-700'}`}>
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div className="flex items-center gap-2">
                                                            <span className="text-xl">{data.theme.icon}</span>
                                                            <div>
                                                                <span className="text-xs font-bold text-slate-300 block">{data.label}</span>
                                                                <span className="text-[10px] text-slate-500 font-mono">ç›®æ¨™: {data.target}%</span>
                                                            </div>
                                                        </div>
                                                        <div className={`text-[10px] font-bold px-2 py-1 rounded-md border ${statusColor}`}>
                                                            {statusText}
                                                        </div>
                                                    </div>

                                                    <div className="flex justify-between items-end">
                                                        <div>
                                                            <div className="text-[10px] text-slate-500 mb-0.5">
                                                                {data.type === 'group' ? 'ç¾¤çµ„ç¸½å¸‚å€¼ / å¯¦éš›ä½”æ¯”' : 'ç›®å‰å¸‚å€¼ / å¯¦éš›ä½”æ¯”'}
                                                            </div>
                                                            <div className="flex items-baseline gap-2">
                                                                <span className="text-xl font-black text-white">${Math.round(data.currentVal).toLocaleString()}</span>
                                                                <span className="text-xs font-bold text-slate-400">{(data.currentRatio * 100).toFixed(1)}%</span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    {/* Bar */}
                                                    <div className="w-full h-1.5 bg-slate-700 rounded-full mt-3 overflow-hidden">
                                                        <div 
                                                            className={`h-full rounded-full transition-all duration-500 ${data.isLockedPreventSell ? 'bg-amber-500' : (isHigher ? 'bg-emerald-500' : 'bg-indigo-500')}`} 
                                                            style={{ width: `${Math.min(data.currentRatio * 100, 100)}%` }}
                                                        ></div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </section>

                                {/* Action Steps */}
                                <section>
                                    <h2 className="text-xs font-black text-slate-500 uppercase tracking-widest px-1 mb-3">æœ€ä½³åŒ–è·¯å¾‘ (å…ˆè³£å¾Œè²·)</h2>
                                    <div className="bg-gradient-to-b from-indigo-900/40 to-slate-900 rounded-3xl p-6 shadow-xl border border-indigo-500/30">
                                        {report.actions.length > 0 ? (
                                            <div className="space-y-4">
                                                {report.actions.map((act, i) => (
                                                    <div key={i} className="flex gap-4 items-start border-b border-white/5 pb-3 last:border-0 last:pb-0">
                                                        <span className="bg-indigo-500/20 text-indigo-300 w-6 h-6 rounded-lg flex items-center justify-center text-[10px] font-black mt-0.5 shrink-0 border border-indigo-500/30">{i+1}</span>
                                                        <span className="text-slate-200 text-sm font-bold leading-relaxed">{act}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="text-center py-4">
                                                <div className="text-3xl mb-2">âœ¨</div>
                                                <p className="text-indigo-300 font-bold text-sm">é…ç½®å¹³è¡¡ (æˆ–å·²é–å®š)ï¼Œç¶­æŒç¾ç‹€</p>
                                            </div>
                                        )}
                                    </div>
                                </section>

                                {/* Target Amount Comparison */}
                                <section>
                                    <h2 className="text-xs font-black text-slate-500 uppercase tracking-widest px-1 mb-3">å†å¹³è¡¡å¾Œç›®æ¨™å¸‚å€¼</h2>
                                    <div className="space-y-2">
                                        {report.data.map((data) => {
                                            const isAdd = data.diff >= 0;
                                            return (
                                                <div key={data.id} className="bg-slate-800 px-4 py-3 rounded-xl border border-slate-700 flex justify-between items-center text-sm">
                                                    <div className="flex items-center gap-2">
                                                        <span className="text-base">{data.theme.icon}</span>
                                                        <span className="font-bold text-slate-300 text-xs">{data.label.split(' ')[0]}</span>
                                                    </div>
                                                    <div className="flex flex-col items-end">
                                                        <div className="flex items-baseline gap-2">
                                                            <span className="font-mono font-bold text-white">${Math.round(data.targetAmount).toLocaleString()}</span>
                                                            <span className="text-xs font-bold text-slate-500">{data.target}%</span>
                                                        </div>
                                                        
                                                        {/* èª¿æ•´é‡‘é¡ */}
                                                        <div className="flex items-center gap-1 mt-0.5">
                                                            <span className="text-[9px] text-slate-600 mr-1">èª¿æ•´:</span>
                                                            {data.isLockedPreventSell ? (
                                                                <span className="text-[10px] font-bold text-amber-500">ğŸ”’ é–å®šä¸è³£</span>
                                                            ) : (
                                                                <span className={`text-[10px] font-bold ${isAdd ? 'text-indigo-400' : 'text-rose-400'}`}>
                                                                    {isAdd ? '+' : ''}{Math.round(data.diff).toLocaleString()}
                                                                </span>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </section>
                            </div>
                        ) : (
                            <div className="text-center py-24 opacity-30">
                                <div className="text-6xl mb-4 grayscale filter">ğŸ›ï¸</div>
                                {report.isValid ? (
                                    <p className="font-black text-slate-400">è¼¸å…¥è³‡ç”¢èˆ‡ç›®æ¨™æ¯”ä¾‹</p>
                                ) : (
                                    <p className="font-black text-rose-400">è«‹èª¿æ•´æ¯”ä¾‹ç¸½å’Œè‡³ 100%</p>
                                )}
                            </div>
                        )}
                    </main>

                    <footer className="mt-8 text-center px-4 pb-8">
                        <div className="w-12 h-1 bg-slate-800 mx-auto rounded-full mb-4"></div>
                        <p className="text-[10px] font-black text-slate-600 uppercase tracking-[0.2em] mb-2">442 Aggressive Strategy</p>
                        <p className="text-[9px] text-slate-700 leading-relaxed font-bold">
                            é»æ“Š ğŸ”“ å¯åˆ‡æ›è³‡ç”¢é–å®šç‹€æ…‹<br/>
                            é–å®šæ™‚ï¼Œå³ä½¿è¶…æ¨™ä¹Ÿä¸æœƒå»ºè­°è³£å‡º
                        </p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
